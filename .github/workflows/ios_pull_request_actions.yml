name: iOS Pull Request
on:
  pull_request:
    branches:
      - develop
jobs:
  # CI
  deploy_ios:
    name: Build Flutter (iOS)
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.1
        with:
          access_token: ${{ github.token }}
      
      # - uses: maxim-lobanov/setup-xcode@v1
      #   with:
      #     xcode-version: '14.1'

      - name: Run Flutter tasks
        uses: subosito/flutter-action@v1
        with:
          flutter-version: '3.3.10'

      - name: CocoaPod Install
        run: cd ./ios && pod install
      
      - name: Install Bundler
        run: cd ./ios && gem install bundler

      - name: Install gems
        run: cd ./ios && bundle install
      
      - run: flutter clean
      
      - run: flutter pub get
      
      # - run: flutter build ios --release #--no-codesign

      # - name: Deploy iOS Beta to AppCenter via Fastlane
      #   uses: maierj/fastlane-action@v1.4.0
      #   with:
      #     lane: dev_appCenter
      #     subdirectory: ios
      #   env:
      #     ITC_TEAM_ID: '${{ secrets.ITC_TEAM_ID }}'
      #     APPLICATON_ID: '${{ secrets.APPLICATON_ID }}'
      #     BUNDLE_IDENTIFIER: '${{ secrets.BUNDLE_IDENTIFIER }}'
      #     DEVELOPER_PORTAL_TEAM_ID: '${{ secrets.DEVELOPER_PORTAL_TEAM_ID }}'
      #     FASTLANE_APPLE_ID: '${{ secrets.FASTLANE_APPLE_EMAIL_ID }}'
      #     FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD: '${{ secrets.FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD }}'
      #     MATCH_PASSWORD: '${{ secrets.MATCH_PASSWORD }}'
      #     GIT_AUTHORIZATION: '${{ secrets.GIT_AUTHORIZATION }}'
      #     PROVISIONING_PROFILE_SPECIFIER: '${{ secrets.PROVISIONING_PROFILE_SPECIFIER }}'
      #     TEMP_KEYCHAIN_PASSWORD: '${{ secrets.TEMP_KEYCHAIN_PASSWORD }}'
      #     TEMP_KEYCHAIN_USER: '${{ secrets.TEMP_KEYCHAIN_USER }}'
      #     WORKSPACE: '${{ secrets.WORKSPACE }}'
      #     SCHEME_DEV: '${{ secrets.SCHEME_DEV }}'
      #     EXPORT_METHOD: '${{ secrets.EXPORT_METHOD }}'
      #     FASTLANE_MATCH_TYPE: '${{ secrets.FASTLANE_MATCH_TYPE }}'
      #     APP_CENTER_OWNER_NAME: '${{ secrets.FASTLANE_MATCH_TYPE }}'
      #     APP_CENTER_APP_NAME: '${{ secrets.APP_CENTER_APP_NAME }}'
      #     APP_CENTER_DEV_GROUPS: '${{ secrets.APP_CENTER_DEV_GROUPS }}'
      #     APP_CENTER_DISTRIBUTION_GROUPS: '${{ secrets.APP_CENTER_DISTRIBUTION_GROUPS }}'
      #     APP_CENTER_NOTIFY_TESTERS: '${{ secrets.APP_CENTER_NOTIFY_TESTERS }}'
      #     APP_CENTER_API_KEY: '${{ secrets.APP_CENTER_API_KEY }}'
      #     APP_CENTER_API_TOKEN: '${{ secrets.APP_CENTER_API_TOKEN }}'
        



      # - uses: maxim-lobanov/setup-xcode@v1        
      #   with: 
      #     xcode-version: "14.1"
      # - uses: actions/checkout@v2
      # - name: Cancel Previous Runs
      #   uses: styfle/cancel-workflow-action@0.9.1
      #   with:
      #     access_token: ${{ github.token }}
      # - name: Bundle install
      #   run: cd ./ios && bundle install
      # - name: Setup JDK
      #   uses: actions/setup-java@v1
      #   with:
      #     java-version: "12.x"
      # - name: Run Flutter tasks
      #   uses: subosito/flutter-action@v1
      #   with:
      #     flutter-version: '3.3.10'
      # - run: flutter clean
      # - run: flutter pub get
      - name: Deploy iOS Beta to AppCenter via Fastlane
        run: |
            cd ./ios && bundle exec fastlane ios dev_appCenter
        env:
          ITC_TEAM_ID: '${{ secrets.ITC_TEAM_ID }}'
          APPLICATON_ID: '${{ secrets.APPLICATON_ID }}'
          BUNDLE_IDENTIFIER: '${{ secrets.BUNDLE_IDENTIFIER }}'
          DEVELOPER_PORTAL_TEAM_ID: '${{ secrets.DEVELOPER_PORTAL_TEAM_ID }}'
          FASTLANE_APPLE_ID: '${{ secrets.FASTLANE_APPLE_EMAIL_ID }}'
          FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD: '${{ secrets.FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD }}'
          MATCH_PASSWORD: '${{ secrets.MATCH_PASSWORD }}'
          GIT_AUTHORIZATION: '${{ secrets.GIT_AUTHORIZATION }}'
          PROVISIONING_PROFILE_SPECIFIER: '${{ secrets.PROVISIONING_PROFILE_SPECIFIER }}'
          TEMP_KEYCHAIN_PASSWORD: '${{ secrets.TEMP_KEYCHAIN_PASSWORD }}'
          TEMP_KEYCHAIN_USER: '${{ secrets.TEMP_KEYCHAIN_USER }}'
          WORKSPACE: '${{ secrets.WORKSPACE }}'
          SCHEME_DEV: '${{ secrets.SCHEME_DEV }}'
          EXPORT_METHOD: '${{ secrets.EXPORT_METHOD }}'
          FASTLANE_MATCH_TYPE: '${{ secrets.FASTLANE_MATCH_TYPE }}'
          APP_CENTER_OWNER_NAME: '${{ secrets.FASTLANE_MATCH_TYPE }}'
          APP_CENTER_APP_NAME: '${{ secrets.APP_CENTER_APP_NAME }}'
          APP_CENTER_DEV_GROUPS: '${{ secrets.APP_CENTER_DEV_GROUPS }}'
          APP_CENTER_DISTRIBUTION_GROUPS: '${{ secrets.APP_CENTER_DISTRIBUTION_GROUPS }}'
          APP_CENTER_NOTIFY_TESTERS: '${{ secrets.APP_CENTER_NOTIFY_TESTERS }}'
          APP_CENTER_API_KEY: '${{ secrets.APP_CENTER_API_KEY }}'
          APP_CENTER_API_TOKEN: '${{ secrets.APP_CENTER_API_TOKEN }}'